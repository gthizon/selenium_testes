package br.com.projedata.arcturus.teste.testes;

import static br.com.projedata.arcturus.teste.webelements.GeradorRelatoriosElementos.botaoProcessarFiltros;
import static br.com.projedata.arcturus.teste.webelements.GeradorRelatoriosElementos.tipoSaidaRelatorio;
import static br.com.projedata.arcturus.teste.webelements.Parc016Elementos.botaoExcluirPerfil;
import static br.com.projedata.arcturus.teste.webelements.Parc016Elementos.botaoLovIdRotinaPerfil;
import static br.com.projedata.arcturus.teste.webelements.Parc016Elementos.campoIdPerfil;
import static br.com.projedata.arcturus.teste.webelements.Parc016Elementos.campoNomePerfil;
import static br.com.projedata.arcturus.teste.webelements.Parc016Elementos.campoPadraoPerfil;
import static br.com.projedata.arcturus.teste.webelements.Pger001Elementos.botaoAbrirParc016;
import static br.com.projedata.arcturus.teste.webelements.Pger001Elementos.botaoAtualizarPerfis;
import static br.com.projedata.arcturus.teste.webelements.Pger001Elementos.campoSelecionarPerfil;
import static br.com.projedata.arcturus.teste.webelements.Pger001Elementos.fecharJanelaEmissaoRelatorio;
import static br.com.projedata.arcturus.teste.webelements.Pger001Elementos.filtroPeriodoFinal;
import static br.com.projedata.arcturus.teste.webelements.Pger001Elementos.filtroPeriodoInicial;

import java.io.IOException;

import org.apache.pdfbox.pdmodel.encryption.InvalidPasswordException;
import org.openqa.selenium.Keys;
import org.testng.annotations.Parameters;
import org.testng.annotations.Test;

import br.com.projedata.arcturus.teste.metodosgenericos.LoginMetodos;
import br.com.projedata.arcturus.teste.metodosgenericos.Pger001Metodos;
import br.com.projedata.arcturus.teste.recursos.Rotina;
import br.com.projedata.arcturus.teste.recursos.TesteGenerico;
import br.com.projedata.arcturus.teste.webelements.AtualizadorElementos;

public class TesteParc016 extends TesteGenerico {

	LoginMetodos log;
	Rotina rotina;
	AtualizadorElementos atualizador;
	Pger001Metodos ger001;
	String idRegistro;
	

	@Parameters(value = { "login", "senha", "base" })
	@Test(testName = "id: 1 - Testar quantidade de caracteres no campo textarea.")
	public void abrirParc016(String login, String senha, String base) {
		log = new LoginMetodos(this);
		rotina = new Rotina(webDriver);
		log.logar(login, senha, base);
		rotina.selecionarRotina("arc016", "p");
		ger001 = new Pger001Metodos(this);
	}
	
	@Test(testName = "id: 2 - Inserir novo perfil", dependsOnMethods = {"abrirParc016"})
	public void inserirPerfil() {
		acao.clicarNoElemento(rotina.botaoNovo);
		rotina.aguardarProcessarRotina();
		acao.escreverNoElemento(campoNomePerfil, 1, "Teste automação");
		teclado.pressionarTeclaDeControle(Keys.TAB);
		acao.clicarNoElemento(botaoLovIdRotinaPerfil, 1);
		rotina.filtrarESelecionarValorNaLov("rger488");
		rotina.aguardarProcessarRotina();
		acao.selecionarNoElemento(campoPadraoPerfil, "Sim");
		rotina.salvarEAguardarMensagemRegistrosAlterados();
		idRegistro = rotina.buscarElementos(campoIdPerfil, 1).getAttribute("value").toString();
		rotina.fecharRotina("arc016");
	}
	
	@Test(testName = "id: 3 - Abrir a pger001 selecionar o relatorio e emitir com o perfil selecionado", dependsOnMethods = {"inserirPerfil"})
	public void abrirORelatorioEVerificarOPerfilCriado() {
		rotina.selecionarRotina("ger001","p");
		ger001.selecionarRelatorioParaEdicao("rger488");
		ger001.executarRelatorio(rotina);
		String perfil = acao.retornarValorSelecionadoNoElemento(campoSelecionarPerfil);
		testar.passouSeValorContem(perfil, "Teste automação");
		ger001.fecharRelatorio();
		rotina.fecharRotina("ger001");
	}
	
	@Test(testName = "id: 4 - Excluir filtro criado", dependsOnMethods = {"abrirORelatorioEVerificarOPerfilCriado"})
	public void excluirFiltroCriado() {
		rotina.selecionarRotina("arc016", "p");
		acao.clicarNoElemento(rotina.botaoLimparConsulta);
		rotina.aguardarProcessarRotina();
		acao.escreverNoElemento(campoIdPerfil, idRegistro);
		acao.clicarNoElemento(rotina.botaoConsultar);
		rotina.aguardarProcessarRotina();
		acao.clicarNoElemento(botaoExcluirPerfil, 0);
		espera.aguardarElementoEstarVazio(campoIdPerfil);
		rotina.fecharRotina("arc016");
	}
	
	@Test(testName = "id: 5 - Abrir parc016 pela tela do gerador de relatorios", dependsOnMethods = {"excluirFiltroCriado"})
	public void abrirArc016PelaGer001() {
		rotina.selecionarRotina("ger001", "p");
		ger001.selecionarRelatorioParaEdicao("rger488");
		ger001.executarRelatorio(rotina);
		acao.clicarNoElemento(botaoAbrirParc016);
		rotina.verificarRotinaCarregada("arc016");
		espera.aguardarElementoEstarVisivel(campoNomePerfil);
		acao.escreverNoElemento(campoNomePerfil, "teste automacao pger1");
		rotina.salvarEAguardarMensagemRegistrosAlterados();
		idRegistro = rotina.buscarElementos(campoIdPerfil, 0).getAttribute("value").toString();
		rotina.fecharRotina("arc016");
		acao.clicarNoElemento(botaoAtualizarPerfis);
		rotina.aguardarProcessarRotina();
		acao.selecionarNoElemento(campoSelecionarPerfil, "teste automacao pger1");
	}
	
	@Test(testName = "id: 6 - Emitir relatorio com o perfil criado", dependsOnMethods = {"abrirArc016PelaGer001"})
	public void emitirRelatorioComOPerfilCriado() throws InvalidPasswordException, IOException {
		acao.escreverNoElemento(filtroPeriodoInicial, "01052017");
		teclado.pressionarTeclaDeControle(Keys.TAB);
		rotina.aguardarProcessarRotina();
		acao.escreverNoElemento(filtroPeriodoFinal, "01102017");
		teclado.pressionarTeclaDeControle(Keys.TAB);
		rotina.aguardarProcessarRotina();
		acao.selecionarNoElemento(tipoSaidaRelatorio, "PDF");
		acao.clicarNoElemento(botaoProcessarFiltros);
		espera.aguardarElementoDesaparecer(rotina.botaoProcessarFiltros);
		testar.passouSeValorContem(rotina.retornarConteudoDoPdf(), "TESTE CADASTRO DE PERFIS (NÃO EXCLUIR)");
		testar.passouSeValorContem(rotina.retornarConteudoDoPdf(), "01/05/2017 - 01/10/2017");
		acao.clicarNoElemento(fecharJanelaEmissaoRelatorio);
		espera.aguardarElementoDesaparecer(fecharJanelaEmissaoRelatorio);
		rotina.aguardarProcessarRotina();
		rotina.fecharRotina("ger001");
		excluirFiltroCriado();
	}

}
